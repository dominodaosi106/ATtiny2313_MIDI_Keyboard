# ATtiny2313_MIDI_Keyboard
# MIDIコントローラ基板 取扱説明書(ver1用）

## 概要
このMIDIコントローラ基板は、ATtiny2313Aマイクロコントローラを搭載し、MIDI信号を送信して楽器やソフトウェアを制御するためのデバイスです。以下の機能を提供します：
- 12個のノートボタン（C, C#, D, D#, E, F, F#, G, G#, A, A#, B）による音階の発音
- MIDIチャンネル選択（1～16）
- オクターブシフト機能（-5～+3オクターブ）
- プログラムチェンジ（ピアノ、オルゴール、矩形波、ベース+リード）
- MIDIチャンネル10でのオクターブシフトロック機能

電源を入れると、初期設定に基づいてMIDIチャンネルと基準ノートが設定され、ボタン操作で音を鳴らしたり設定を変更したりできます。

## 操作方法

### 1. 基本操作
- **ノートボタン（C, C#, D, D#, E, F, F#, G, G#, A, A#, B）**：
  - 押す：対応する音階をMIDI信号として発音（ベロシティ127）。
  - 離す：発音開始時の音階を停止。
  - 例：Cボタンを押してC4が鳴り、オクターブシフト後に離すとC4が停止。
- **オクターブシフト（UP/DOWNボタン）**：
  - **短押し（200ms未満）**：押すと即時にオクターブが上下し、離してもシフトを維持。
  - **長押し（200ms以上）**：押すと即時にオクターブが上下し、離すと元のオクターブに戻る。
  - 範囲：-5～+3オクターブ（例：C4→C-1～C7）。
- **ファンクションキー（UP+DOWN同時押し）**：
  - UPとDOWNボタンを同時に押すと、ファンクションキーモードに移行。
  - 他のボタン（C#, D#, F#, A#, C, D, A, B）を押して各種設定を変更。
  - どちらかのボタンを離すと通常モードに戻る。

### 2. ファンクションキーモードでの操作
ファンクションキーモード（UP+DOWN同時押し）で以下の操作が可能です：
- **MIDIチャンネル変更**：
  - **C#**：MIDIチャンネル1（基準ノート：C4）に設定。
  - **D#**：MIDIチャンネル10に設定（基準ノートは現在の値を保持）。
  - **F#**：MIDIチャンネルを1つ下げる（1～16、基準ノートは保持）。
  - **A#**：MIDIチャンネルを1つ上げる（1～16、基準ノートは保持）。
- **プログラムチェンジ**：
  - **C**：プログラム1（ピアノ）に変更。
  - **D**：プログラム10（オルゴール）に変更。
  - **A**：プログラム88（ベース+リード）に変更。
  - **B**：プログラム81（矩形波）に変更。

### 3. 初期設定
- **MIDIチャンネルと基準ノート**：
  - 起動時のCHピンの状態で初期設定：
    - CHピンがLOW：MIDIチャンネル1、基準ノートC4（60）。
    - CHピンがHIGH：MIDIチャンネル10、基準ノートC2（36）。
- **オクターブシフト**：
  - 初期値は0（基準ノートそのまま）。
  - MIDIチャンネル10でMODEピンがHIGHの場合、オクターブシフトは無効（常に0）。

### 4. 注意事項
- **オクターブシフト中の発音**：
  - ノートボタンを押している間にオクターブシフトしても、発音中の音は継続。
  - ノートボタンを離すと、押した時点の音階（例：C4）が停止。
  - 新たに押したノートは現在のオクターブシフトを反映（例：C5）。
- **MIDIチャンネル変更**：
  - CH1からCH10に変更しても、現在の基準ノート（例：C4やC6）が保持される。
  - CH1への変更（C#）では基準ノートがC4にリセット。
- **MODEピン（MIDIチャンネル10）**：
  - MODEピンがHIGHの場合、オクターブシフトが無効化され、基準ノート（C2など）で固定。
- **デバウンス**：
  - ボタン操作は10msのデバウンス処理済み。素早い連打でも安定動作。
- **電源**：
  - 電源投入後、CHピンの状態を即座に読み込み。
  - MIDI機器に正しく接続してください（MIDI OUT端子を使用）。

### 5. トラブルシューティング
- **音が出ない**：
  - MIDIケーブルが正しく接続されているか確認。
  - MIDIチャンネルが受信機器と一致しているか確認（C#, D#, F#, A#で変更）。
  - プログラムチェンジが適切か確認（C, D, A, Bで変更）。
- **オクターブシフトが効かない**：
  - MIDIチャンネル10でMODEピンがHIGHでないか確認（HIGHでシフト無効）。
  - UP/DOWNボタンの短押し/長押しを試す。
- **意図しない音階が鳴る**：
  - 現在の基準ノートとオクターブシフトを確認（CH1: C4ベース、CH10: C2ベース）。
  - ファンクションキー+C#でCH1（C4）にリセット可能。

## 仕様
- **マイクロコントローラ**：ATtiny2313A（内蔵1MHzクロック）
- **ビルド環境**：Atmel Studio 7 (Version: 7.0.129)
- **MIDIボーレート**：31,250bps（標準）
- **電源**：5V（VCC-GND間）
- **ボタン**：12ノートボタン、2シフトボタン（UP/DOWN）、2設定ピン（CH, MODE）

---

ご不明点やサポートが必要な場合は、開発者にご連絡ください。